packrat::init()
packrat::install("dplyr")
install.packages("dplyr")
install.packages("readr")
install.packages("ggplot2")
fcDir <- "/Volumes/genomics/Illumina/150707_D00565_0090_AHMMF2ADXX/"
fcDir <- "/Volumes/genomics/Illumina/150707_D00565_0090_AHMMF2ADXX"
processedDir <- "Project_P115-1Processed"
countsDir <- file.path(fcDir, processedDir, "counts")
list.files(countsDir) %>%
str_extract("combined") %>%
na.omit()
library(dplyr)
library(readr)
list.files(countsDir) %>%
str_extract("combined") %>%
na.omit()
install.packages("stringr")
library(stringr)
list.files(countsDir) %>%
str_extract("combined") %>%
na.omit()
list.files(countsDir)
list.files(countsDir) %>%
str_match("combined") %>%
na.omit()
list.files(countsDir) %>%
str_match(".*combined.*") %>%
na.omit()
countsFile <- list.files(countsDir) %>%
str_detect(".*combined.*") %>%
na.omit()
countsFile <- list.files(countsDir) %>%
str_extract(".*combined.*") %>%
na.omit()
countsFile <- list.files(countsDir) %>%
str_extract(".*combined.*") %>%
na.omit() %>%
file.path(countsDir, .)
countsFile
counts <- read_csv(countsFile)
View(counts)
source("http://bioconductor.org/biocLite.R")
biocLite("biomaRt")
biomaRt::listDatasets(useMart(biomart="ensembl"))
?useMart
library(biomaRt)
biomaRt::listDatasets(useMart(biomart="ensembl"))
mart = useMart(biomart="ensembl", dataset="mmusculus_gene_ensembl")
str(mart)
listAttributes(mart)
listAttributes(mart) %>%
str_extract(".*entrez.*") %>%
na.omit()
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "entrezgene"),
filters = "ensembl_gene_id",
values = rownames(counts), mart = mart)
grep("entrezgene", listAttributes(mart))
listAttributes(mart)[1]
grep("entrezgene", listAttributes(mart)[1])
listAttributes(mart)[[1]]
grep("entrezgene", listAttributes(mart)[[1]])
listAttributes(mart)[[1]][53]
listAttributes(mart)[53]
listAttributes(mart)[[2]][53]
View(counts)
test <- getBM(attributes = c("ensembl_gene_id", "entrezgene"))
test <- getBM(attributes = c("ensembl_gene_id", "entrezgene"), mart = mart)
View(test)
sum(!is.na(test$entrezgene))
?getBM
head(rownames(counts))
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "entrezgene"),
filters = "ensembl_gene_id",
values = counts$geneName, mart = mart)
View(ens2Gene)
ens2Gene = ens2Gene[counts$geneName, ens2Gene$ensembl_gene_id), ]
ens2Gene = ens2Gene[match(counts$geneName, ens2Gene$ensembl_gene_id), ]
View(ens2Gene)
View(counts)
counts2 <- counts %>%
mutate(entrezID = ens2Gene$entrezgene)
View(counts2)
colOrder <- c(names(counts)[1], names(counts)[length(counts)],
names(counts)[2:length(counts)-1])
colOrder
names(counts)
colOrder <- c(names(counts)[1], names(counts)[length(counts)],
names(counts)[2:(length(counts)-1]))
colOrder <- c(names(counts)[1], names(counts)[length(counts)],
names(counts)[2:(length(counts)-1)])
colOrder
names(counts)[length(counts)]
colOrder <- c(names(counts2)[1], names(counts2)[length(counts2)],
names(counts2)[2:(length(counts2)-1)])
colOrder
counts2 <- counts2 %>%
select(one_of(colOrder))
?select
library(dplyr)
counts2 <- counts2 %>%
select(one_of(colOrder))
counts2 <- counts2 %>%
dplyr::select(one_of(colOrder))
View(counts2)
counts2 <- counts2 %>%
dplyr::select(one_of(colOrder)) %>%
mutate(entrezID = ifelse(is.na(entrezID), "NA", entrezID))
View(counts2)
countsEntrez <- counts %>%
mutate(entrezID = ens2Gene$entrezgene)
colOrder <- c(names(countsEntrez)[1], names(countsEntrez)[length(countsEntrez)],
names(countsEntrez)[2:(length(countsEntrez)-1)])
countsEntrez <- countsEntrez %>%
dplyr::select(one_of(colOrder)) %>%
mutate(entrezID = ifelse(is.na(entrezID), "NA", entrezID))
View(countsEntrez)
countsDir
countsFileNew <- str_replace(countsFile, ".csv", "_wEntrezID.csv")
countsFileNew
write_csv(countsEntre, countsFileNew)
write_csv(countsEntrez, countsFileNew)
library(dplyr)
library(readr)
library(stringr)
library(biomaRt)
# Specify flowcell & project
fcDir <- "/Volumes/genomics/Illumina/150707_D00565_0090_AHMMF2ADXX"
processedDir <- "Project_P115-1Processed"
# Get file path for counts file
countsDir <- file.path(fcDir, processedDir, "counts")
countsFile <- list.files(countsDir) %>%
str_extract(".*combined.*") %>%
na.omit() %>%
file.path(countsDir, .)
# Read in combined counts file
counts <- read_csv(countsFile)
countsFile
countsDir <- file.path(fcDir, processedDir, "counts_wEntrez")
countsFile <- list.files(countsDir) %>%
str_extract(".*combined.*") %>%
na.omit() %>%
file.path(countsDir, .)
countsDir <- file.path(fcDir, processedDir, "counts")
countsFile <- list.files(countsDir) %>%
str_extract(".*combined_counts.*") %>%
na.omit() %>%
file.path(countsDir, .)
mart <- useMart(biomart = "ensembl", dataset = "mmusculus_gene_ensembl")
listAttributes(mart)
listAttributes(mart)[54]
listAttributes(mart)[1][54]
listAttributes(mart)[[1]][54]
listAttributes(mart)[[1]][55]
listAttributes(mart)[[1]][53]
listAttributes(mart)[[1]][52]
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "entrezgene_transcript_name"),
filters = "ensembl_gene_id",
values = counts$geneName, mart = mart)
counts <- read_csv(countsFile)
countsFile <- list.files(countsDir) %>%
str_extract(".*combined_counts.csv") %>%
na.omit() %>%
file.path(countsDir, .)
counts <- read_csv(countsFile)
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "entrezgene_transcript_name"),
filters = "ensembl_gene_id",
values = counts$geneName, mart = mart)
View(counts)
View(ens2Gene)
listAttributes(mart)[[1]] %>% which(str_detect("hgnc"))
?str_detect
listAttributes(mart)[[1]] %>% which(str_detect(., "hgnc"))
listAttributes(mart)[[1]] %>% str_detect(., "hgnc")
listAttributes(mart)[[1]] %>% str_detect(., "hgnc") %>% which()
listAttributes(mart)[[1]][59:61]
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values = counts$geneName, mart = mart)
View(ens2Gene)
ens2Gene = ens2Gene[match(counts$geneName, ens2Gene$ensembl_gene_id), ]
View(ens2Gene)
listAttributes(mart)[[1]] %>% str_detect(., "mgi") %>% which()
listAttributes(mart)[[1]][67:70]
ens2Gene <- getBM(attributes = c("ensembl_gene_id", "mgi_symbol"),
filters = "ensembl_gene_id",
values = counts$geneName, mart = mart)
View(ens2Gene)
ens2Gene = ens2Gene[match(counts$geneName, ens2Gene$ensembl_gene_id), ]
View(ens2Gene)
countsMgi <- counts %>%
mutate(mgiSymbol = ens2Gene$mgi_symbol)
colOrder <- c(names(countsMgi)[1], names(countsMgi)[length(countsMgi)],
names(countsMgi)[2:(length(countsMgi)-1)])
countsMgi <- countsMgi %>%
dplyr::select(one_of(colOrder)) %>%
mutate(mgiSymbol = ifelse(is.na(mgiSymbol), "NA", mgiSymbol))
View(countsMgi)
countsFileNew <- str_replace(countsFile, ".csv", "_wMgiSymbol.csv")
write_csv(countsMgi, countsFileNew)
